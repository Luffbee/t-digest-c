---
output: rmarkdown::github_document
editor_options: 
  chunk_output_type: console
---
```{r pkg-knitr-opts, include=FALSE}
knitr::opts_chunk$set(collapse=TRUE, fig.retina=2, message=FALSE, warning=FALSE)
options(width=120)
```

[![Travis-CI Build Status](https://travis-ci.org/hrbrmstr/tdigest.svg?branch=master)](https://travis-ci.org/hrbrmstr/tdigest) 
[![Coverage Status](https://codecov.io/gh/hrbrmstr/tdigest/branch/master/graph/badge.svg)](https://codecov.io/gh/hrbrmstr/tdigest)
[![CRAN_Status_Badge](https://www.r-pkg.org/badges/version/tdigest)](https://cran.r-project.org/package=tdigest)

# tdigest

Wicked Fast, Accurate Quantiles Using 't-Digests'

## Description

The t-digest construction algorithm uses a variant of 1-dimensional k-means clustering to produce a very compact data structure that allows accurate estimation of quantiles. This t-digest data structure can be used to estimate quantiles, compute other rank statistics or even to estimate related measures like trimmed means. The advantage of the t-digest over previous digests for this purpose is that the t-digest handles data with full floating point resolution. With small changes, the t-digest can handle values from any ordered set for which we can compute something akin to a mean. The accuracy of quantile estimates produced by t-digests can be orders of magnitude more accurate than those produced by previous digest algorithms.

See [the original paper by Ted Dunning](https://raw.githubusercontent.com/tdunning/t-digest/master/docs/t-digest-paper/histo.pdf) for more details on t-Digests.

## What's Inside The Tin

The following functions are implemented:

- `is_tdigest`: Test to see if an object is classed as `tdigest`
- `tdigest`:	Create a new t-digest histogram from a vector
- `td_add`:	Add a value to the t-digest with the specified count
- `td_create`:	Allocate a new histogram
- `td_merge`:	Merge one t-digest into another
- `td_quantile_of`:	Return the quantile of the value
- `td_total_count`:	Total items contained in the t-digest
- `td_value_at`:	Return the value at the specified quantile
- `tquantile`:	Calcuate sample quantiles from a t-digest

## Installation

```{r install-ex, eval=FALSE}
install.packages("tdigest", repos="https://cinc.rud.is/")
# or 
devtools::install_git("https://sr.ht.com/~hrbrmstr/tdigest.git")
# or
devtools::install_gitlab("hrbrmstr/tdigest")
# or (if you must)
devtools::install_github("hrbrmstr/tdigest")
```

## Usage

```{r lib-ex}
library(tdigest)

# current version
packageVersion("tdigest")

```

### Basic (Low-level interface)

```{r}
td <- td_create(10)

td

td_total_count(td)

td_add(td, 0, 1) %>% 
  td_add(10, 1)

td_total_count(td)

td_value_at(td, 0.1) == 0
td_value_at(td, 0.5) == 5

quantile(td)
```

#### Bigger (and Vectorised)

```{r}
td <- tdigest(c(0, 10), 10)

is_tdigest(td)

td_value_at(td, 0.1) == 0
td_value_at(td, 0.5) == 5

set.seed(1492)
x <- sample(0:100, 1000000, replace = TRUE)
td <- tdigest(x, 1000)

td_total_count(td)

tquantile(td, c(0, 0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.99, 1))

quantile(td)
```

#### Proof it's faster

```{r}
microbenchmark::microbenchmark(
  tdigest = tquantile(td, c(0, 0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.99, 1)),
  r_quantile = quantile(x, c(0, 0.01, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.99, 1))
)
```

## tdigest Metrics

```{r cloc, echo=FALSE}
cloc::cloc_pkg_md()
```

## Code of Conduct

Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). 
By participating in this project you agree to abide by its terms.
